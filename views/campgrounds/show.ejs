<%include ../partials/header %>

	<div class='row'>
		<div class='col-md-2 order-3 order-md-1 mt-3 mt-md-5'>
			<div id='map' class='rounded-lg'></div>
		</div>
		<div class='col-md-10 order-md-3'>
			<div class='card'>
				<img id='image' class='card-img-top' src='<%=campground.img%>'>
				<div class='card-body'>
					<h5 class='card-title display-4'>
							<%=campground.title%>
					</h5>	
					<h4 class='card-subtitle'>
						<% if(currentUser && (currentUser._id.equals(campground.author.id))){ %>
								<a class='new-link' href='/userprofile'>
						<% } else { %>
								<a class='new-link' href='/profiles/<%=campground.author.id%>'>
						<% } %>
							<em>Created by:
								<%=campground.author.username %></em></a>
						
						<span class='float-right'>$<%= campground.price %> per night</span>
					</h4>
					
					<hr class="my-3">
					<p>
						<%=campground.description%>
					</p>
					<p>
						Posted: <%= moment(campground.createdAt).fromNow()%>
							
					</p>

					<div>

						<% if(currentUser && (currentUser.isAdmin||campground.author.id.equals(currentUser._id))){ %>
							<a class='btn btn-sm btn-warning' href='/campgrounds/<%= campground._id%>/edit'>Edit</a>
							<form action='/campgrounds/<%=campground._id%>?_method=DELETE' method='POST'>
								<button class='btn btn-sm btn-danger'>Delete</button>
							</form>
							<% } %>
					</div>
					<div class='text-right'>
						<a class='btn btn-sm btn-success' href='/campgrounds/<%= campground._id%>/comments/new'>
							Leave a Review
						</a>
					</div>
						<hr class='my-3'>
					<ul class="list-unstyled">
						<%campground.comments.forEach(comment=>{%>
						  <li class="media">
							  
							  <div class='col-3'>
								<img src="<%= (comment.author.avatar) ? comment.author.avatar : 'https://res.cloudinary.com/josuemartinez/image/upload/v1586652261/102771372-profile-anonymous-face-icon-gray-silhouette-person-male-businessman-profile-default-avatar-photo-pla_b1yl9d.jpg'%>" class= " mr-3 img-fluid img-thumbnail" alt="<%=comment.author.username %>'s avatar ">  
							  </div>
							<div class="media-body col-9">
							  <p class="mt-0 mb-1">
								  <span class='h5'>
									  <% if(currentUser && (currentUser._id.equals(comment.author.id))){ %>
											<a class='new-link' href='/userprofile'>
										<% } else { %>
											<a class='new-link' href='/profiles/<%=comment.author.id%>'>
										<% } %>
											<%=comment.author.username%>
											</a>
									</span>
									<span class='float-right'>
										<%= moment(comment.createdAt).fromNow()%>
									</span>				
								</p>
								<p>
									<%=comment.text%>	
								</p>	  

								<div>
								<% if(currentUser && (currentUser.isAdmin||comment.author.id.equals(currentUser._id))){ %>
									<a class='btn btn-sm btn-warning' href='/campgrounds/<%= campground._id%>/comments/<%=comment._id%>/edit'>
										Edit
									</a>
									<form action='/campgrounds/<%=campground._id%>/comments/<%=comment._id%>?_method=DELETE' method='POST'>
										<button class='btn btn-sm btn-danger'>Delete</button>
									</form>
									<% } %>
								</div>
							</div>
							  
						  </li>
						<hr class='my-1'>
					  	<% }); %>
					</ul>
					<a href='/campgrounds'>Go back</a>
				</div>
				
			</div>

			
		</div>
	</div>

	<script src='/scripts/show.js'></script>
	<script>
		var c = {
			title: "<%=campground.title %>",
			lat: <%=campground.lat %>,
			lng: <%=campground.lng %>,
			location: "<%=campground.location %>",
			description: "<%=campground.description %>"
		}
		LIBRARY.init(c);
	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXXF7ag3exLwQLuA13x4maEVtsch13uro&callback=LIBRARY.initMap"></script>

	<%include ../partials/footer%>